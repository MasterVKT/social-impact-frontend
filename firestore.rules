rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Users collection - read/write access for authenticated users to their own data
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // KYC data collection - read/write access for authenticated users to their own data
    match /kyc_data/{document} {
      allow read, write: if request.auth != null && request.auth.uid == resource.data.userId;
      allow create: if request.auth != null && request.auth.uid == request.resource.data.userId;
    }
    
    // KYC documents collection - read/write access for authenticated users to their own data
    match /kyc_documents/{document} {
      allow read, write: if request.auth != null;
    }
    
    // Verification steps collection - read/write access for authenticated users
    match /verification_steps/{document} {
      allow read, write: if request.auth != null;
    }
    
    // Risk assessments collection - read/write access for authenticated users
    match /risk_assessments/{document} {
      allow read, write: if request.auth != null;
    }
    
    // Projects collection - read access for all authenticated users, write for creators
    match /projects/{projectId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && (
        // Allow creation if user is the creator
        (request.auth.uid == request.resource.data.creatorId) ||
        // Allow update if user is the creator
        (request.auth.uid == resource.data.creatorId)
      );
    }
    
    // Investments collection - read/write access for authenticated users to their own data
    match /investments/{document} {
      allow read, write: if request.auth != null && request.auth.uid == resource.data.investorId;
      allow create: if request.auth != null && request.auth.uid == request.resource.data.investorId;
    }
    
    // Contributions collection - read/write access for authenticated users to their own data
    match /contributions/{document} {
      allow read, write: if request.auth != null && request.auth.uid == resource.data.userId;
      allow create: if request.auth != null && request.auth.uid == request.resource.data.userId;
    }
    
    // Audits collection - read/write access for auditors and admins
    match /audits/{document} {
      allow read, write: if request.auth != null;
    }
    
    // Activities collection - read/write access for authenticated users to their own data
    match /activities/{document} {
      allow read, write: if request.auth != null && request.auth.uid == resource.data.userId;
      allow create: if request.auth != null && request.auth.uid == request.resource.data.userId;
    }
    
    // Notifications collection - read/write access for authenticated users to their own data
    match /notifications/{document} {
      allow read, write: if request.auth != null && request.auth.uid == resource.data.userId;
      allow create: if request.auth != null && request.auth.uid == request.resource.data.userId;
    }
    
    // Reports collection - read access for authenticated users
    match /reports/{document} {
      allow read: if request.auth != null;
      allow write: if request.auth != null;
    }
    
    // Analytics collection - read access for authenticated users
    match /analytics/{document} {
      allow read: if request.auth != null;
      allow write: if request.auth != null;
    }
  }
}
